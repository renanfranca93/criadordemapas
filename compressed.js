var elementControl=0,allMapElements=[],numberStyle=2,typeOfSystem="";function changeBg(){5<++numberStyle&&(numberStyle=1);var e=numberStyle+1;5<e&&(e=1);var t=document.getElementById("selectorBg"),n=document.querySelector("body");t.removeAttribute("class"),n.removeAttribute("class"),t.setAttribute("class","bgSelector bgStyle"+e),n.setAttribute("class","bgStyle"+numberStyle),localStorage.setItem("criadordemasmorrabg","bgStyle"+numberStyle)}function rolld6(){var e=Math.floor(6*Math.random())+1,t=document.getElementById("d6");setTimeout(function(){t.removeAttribute("class"),t.setAttribute("class","diceRoller dice"+e)},1e3),t.setAttribute("class","diceRoller diceWhat shake")}function loadPage(){var e=(e=localStorage.getItem("criadordemasmorrabg"))||"bgStyle2",t=document.querySelector("body");t.removeAttribute("class"),t.setAttribute("class",e),bgseletor=e.split("bgStyle"),bgSeletorValue=bgseletor[1],bgSeletorValue++,5<bgSeletorValue&&(bgSeletorValue=1);var n=document.getElementById("selectorBg");n.removeAttribute("class"),n.setAttribute("class","bgSelector bgStyle"+bgSeletorValue);var l=window.location.href;-1!==l.search("modal")&&document.getElementById("myBtn").click();var o,a=l.search("type"),d=document.getElementById("logo");-1!==a?(typeOfSystem="dg",d.removeAttribute("src"),d.setAttribute("src","img/logo-dungeon.png"),document.getElementById("addItemMap").setAttribute("class","invisible"),document.getElementById("deleteItemMap").setAttribute("class","invisible"),document.getElementById("toDundGen").setAttribute("class","invisible"),document.getElementById("newMap").setAttribute("class","invisible"),document.getElementById("chooseClassMap").setAttribute("class","invisible"),(o=document.getElementById("modalBtn")).setAttribute("src","img/icons/world.png"),o.setAttribute("title","Alternar para o Criador de Mundos")):(typeOfSystem="mp",d.removeAttribute("src"),d.setAttribute("src","img/logo-map.png"),document.getElementById("addItemDungeon").setAttribute("class","invisible"),document.getElementById("deleteDgElement").setAttribute("class","invisible"),document.getElementById("toWorldGen").setAttribute("class","invisible"),document.getElementById("newDung").setAttribute("class","invisible"),document.getElementById("chooseClass").setAttribute("class","invisible"),(o=document.getElementById("modalBtn")).setAttribute("src","img/icons/dungeon.png"),o.setAttribute("title","Alternar para o Criador de Dungeons"))}function redirect(e,t,n){window.location.href=n?t?"./"+e+".html?modal=1&type=dg":"./"+e+".html?type=dg":t?"./"+e+".html?modal=1":"./"+e+".html?"}function closeModal(){modal.style.display="none"}function openModal(){document.getElementById("myBtn").click()}function mountSelectMap(){var e,t,n=document.getElementById("selectmap"),l=localStorage;if("mp"==typeOfSystem)for(var o in l){o.includes("world.")&&(e=o.replace("world.",""),(t=document.createElement("option")).value=e,t.innerHTML=e,n.appendChild(t))}else for(var o in l){o.includes("dungeon.")&&(e=o.replace("dungeon.",""),(t=document.createElement("option")).value=e,t.innerHTML=e,n.appendChild(t))}}function addElement(e){var t,n,l=(d="mp"==typeOfSystem?document.getElementById("addTiles").value:document.getElementById("addelement").value).split("-");document.querySelector("#group")||(t=document.querySelector("#corpo"),(n=document.createElement("div")).setAttribute("id","group"),t.appendChild(n));var o=document.querySelector("#group");if(e){var a,d=document.getElementById("addTextInput").value;return console.log(d),(a=document.createElement("div")).setAttribute("id","dgn99text"+elementControl+"dgn99"),a.setAttribute("class","textdiv"),a.setAttribute("title","text"+elementControl),a.innerText=d,o.appendChild(a),dragElement(document.getElementById("dgn99text"+elementControl+"dgn99")),allMapElements.push("text"+elementControl),mountaAllMapElements(allMapElements),void elementControl++}(a=document.createElement("div")).setAttribute("id","dgn99"+l[1]+elementControl+"dgn99"),a.setAttribute("class",l[0]+" "+l[1]),a.setAttribute("title",l[1]+elementControl),o.appendChild(a),dragElement(document.getElementById("dgn99"+l[1]+elementControl+"dgn99")),allMapElements.push(l[1]+elementControl),mountaAllMapElements(allMapElements),elementControl++}function deleteMapElement(){var e;e="mp"==typeOfSystem?document.getElementById("deleteTiles").value:document.getElementById("deleteelement").value,document.getElementById("dgn99"+e+"dgn99").remove();var t=allMapElements.indexOf(e);allMapElements.splice(t,1),mountaAllMapElements(allMapElements)}function saveMap(){var e=document.querySelector("#group").outerHTML;console.log(e);var t=document.getElementById("nomeMapa").value;console.log(t),"mp"==typeOfSystem?(localStorage.setItem("world."+t,JSON.stringify(e)),closeModal(),redirect("index",!0)):(localStorage.setItem("dungeon."+t,JSON.stringify(e)),closeModal(),redirect("index",!0,!0))}function deleteMap(){var e=document.getElementById("selectmap").value;"mp"==typeOfSystem?(localStorage.removeItem("world."+e),redirect("index",!0)):(localStorage.removeItem("dungeon."+e),redirect("index",!0,!0))}function mountaAllMapElements(){var e;(e="mp"==typeOfSystem?document.getElementById("deleteTiles"):document.getElementById("deleteelement")).innerHTML="";var t,n=document.createElement("option");for(n.value=-1,n.innerHTML="Selecionar...",e.appendChild(n),i=allMapElements.length;0<=i;i--){void 0!==allMapElements[i]&&((t=document.createElement("option")).value=allMapElements[i],t.innerHTML=allMapElements[i],e.appendChild(t))}}function loadMap(e){var t;t=e||document.getElementById("selectmap").value;var n,l=document.querySelector("#corpo");l.innerHTML="",n="mp"==typeOfSystem?JSON.parse(localStorage.getItem("world."+t))||"":JSON.parse(localStorage.getItem("dungeon."+t))||"";var o=document.createRange().createContextualFragment(n);l.appendChild(o);var a=n.split("dgn99");for(i=a.length;0<i;i--)i%2!=0&&void 0!==a[i]&&(allMapElements.push(a[i]),dragElement(document.getElementById("dgn99"+a[i]+"dgn99")));closeModal(),mountaAllMapElements()}function salvarPosicao(){var e=document.querySelector("#group");download("mp"==typeOfSystem?"myworld.world":"mydungeon.dungeon",e.outerHTML)}function download(e,t){var n,l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),l.setAttribute("download",e),document.createEvent?((n=document.createEvent("MouseEvents")).initEvent("click",!0,!0),l.dispatchEvent(n)):l.click()}function dragElement(t){var n=0,l=0,o=0,a=0;function e(e){(e=e||window.event).preventDefault(),o=e.clientX,a=e.clientY,document.onmouseup=m,document.onmousemove=d}function d(e){(e=e||window.event).preventDefault(),n=o-e.clientX,l=a-e.clientY,o=e.clientX,a=e.clientY,t.style.top=t.offsetTop-l+"px",t.style.left=t.offsetLeft-n+"px"}function m(){document.onmouseup=null,document.onmousemove=null}document.getElementById(t.id+"header")?document.getElementById(t.id+"header").onmousedown=e:t.onmousedown=e}function readMapFile(){if(0!=document.querySelector("#file-input").files.length){var e=document.querySelector("#file-input").files[0];if("mp"==typeOfSystem){if(-1===e.name.search(".world"))return void alert("Erro : Arquivo selecionado não é do tipo .world")}else if(-1===e.name.search(".dungeon"))return void alert("Erro : Arquivo selecionado não é do tipo .dungeon");var t=new FileReader;t.addEventListener("load",function(e){var t=e.target.result;console.log(t);var n=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5);"mp"==typeOfSystem?(localStorage.setItem("world.Importado_"+n,JSON.stringify(t)),redirect("index",!0)):(localStorage.setItem("dungeon.Importado_"+n,JSON.stringify(t)),redirect("index",!0,!0))}),t.readAsText(e)}else alert("Erro : Nenhum arquivo de dungeon selecionado")}var modal=document.getElementById("myModal"),btn=document.getElementById("myBtn"),span=document.getElementsByClassName("close")[1];btn.onclick=function(){modal.style.display="block"},span.onclick=function(){modal.style.display="none"},window.onclick=function(e){e.target==modal&&(modal.style.display="none")};var modal2=document.getElementById("confirmChange"),modalBtn=document.getElementById("modalBtn"),span2=document.getElementsByClassName("nao_class")[0],span3=document.getElementsByClassName("close")[0];modalBtn.onclick=function(){modal2.style.display="block"},span2.onclick=function(){modal2.style.display="none"},span3.onclick=function(){modal2.style.display="none"},window.onclick=function(e){e.target==modal2&&(modal2.style.display="none")};var modalUp=document.getElementById("uploadImageModal"),btnUp=document.getElementById("btnUpload"),spanUp=document.getElementById("closeUp");btnUp.onclick=function(){modalUp.style.display="block"},spanUp.onclick=function(){modalUp.style.display="none"},window.onclick=function(e){e.target==modal&&(modalUp.style.display="none")};var input=document.getElementById("myfile");function showImage(e){var t,n;document.querySelector("#group")||(t=document.querySelector("#corpo"),(n=document.createElement("div")).setAttribute("id","group"),t.appendChild(n));var l,o,a=document.querySelector("#group");-1!=(l="mp"==typeOfSystem?document.getElementById("chooseClassMap").value:document.getElementById("chooseClass").value)?((o=document.createElement("img")).setAttribute("src","data:image/jpeg;base64,"+e),o.setAttribute("id","dgn99img"+elementControl+"dgn99"),o.setAttribute("title","img"+elementControl),o.setAttribute("class",l),a.appendChild(o),dragElement(document.getElementById("dgn99img"+elementControl+"dgn99")),allMapElements.push("img"+elementControl),mountaAllMapElements(allMapElements),modalUp.style.display="none",elementControl++):alert("Escolha uma classe antes de escolher a imagem!")}input.onchange=function(){var e=input.files[0],t=new FileReader;t.onloadend=function(){showImage(t.result.replace(/^data:.+;base64,/,""))},t.readAsDataURL(e)},loadPage(),mountSelectMap();